# oracle拾遗

## with admin option和with grant option的区别

1、with admin option
with admin option的意思是被授予该权限的用户有权将某个权限(如create any table)授予其他用户或角色，取消是不级联的。
如授予A系统权限create session with admin option,然后A又把create session权限授予B,但管理员收回A的create session权限时，B依然拥有create session的权限。但管理员可以显式收回B create session的权限，即直接revoke create session from B.

2、with grant option
with grant option的意思是：权限赋予/取消是级联的，如将with grant option用于对象授权时，被授予的用户也可把此对象权限授予其他用户或角色，不同的是当管理员收回用with grant option授权的用户对象权限时，权限会因传播而失效，如grant select on table with grant option to A,A用户把此权限授予B，但管理员收回A的权限时，B的权限也会失效，但管理员不可以直接收回B的SELECT ON TABLE 权限。

## OracleSQL共享的原理是什么?什么样的SQL会被共享?

为了不重复解析相同的SQL语句，在第一次解析之后，Oracle将SQL语句存放在内存中。这块位于系统全局区域SGA(systemglobal area)的共享池(shared buffer pool中的内存可以被所有的数据库用户共享。因此，当你执行一个SQL语句(有时被称为一个游标)时，如果它和之前执行过的语句完全相同，Oracle就能很快获得已经被解析的语句以及最好的执行方案。Oracle的这个功能大大地提高了SQL的执行性能并节省了内存的使用。可惜的是，Oracle只对简单的表提供高速缓冲(cache bufferiIlg)，这个功能并不适用于多表连接查询。数据库管理员必须在启动参数文件中为这个区域设置合适的参数，当这个内存区域越大，就可以保留更多的语句，当然被共享的可能性也就越大了。当向Oracle提交一个SQL语句时，Oracle会首先在这块内存中查找相同的语句SQL共享的三个条件：当前被执行的语句和共享池中的语句必须完全相同 （包括大小写、空格、换行等）两个语句所指的对象必须完全相同 （同义词与表是不同的对象）两个SQL语句中必须使用相同的名字的绑定变量(bind variables)

## SQL语句是否区分大小写？

insert，select  这样的 数据库的  关键字,  是不区分大小写的.

但是  表名， 字段名。
不同的数据库， 会有不同的设置。

例如
SQL Server 是数据库设置，来决定 表名 字段名 是否区分大小写
Oracle 是通过  双引号 来决定
MySQL 是 依赖于 配置 和操作系统来决定 ( Windows 不区分， Linux 区分)

## 表空间与数据文件的区别

涉及到数据库的物理结构和逻辑结构。

首先，你需要明白的一点是：数据库的物理结构是由数据库的操作系统文件所决定，**每一个Oracle数据库是由三种类型的文件组成：数据文件、日志文件和控制文件**。数据库的文件为数据库信息提供真正的物理存储。

**每一个Oracle数据库有一个或多个物理的数据文件（data file）**。

一个数据库的数据文件包含全部数据库数据。逻辑数据库结构（如表、索引等）的数据物理地存储在数据库的数据文件中。数据文件通常为*.dbf格式，例如：userCIMS.dbf。

数据文件有下列特征：

①、一个数据文件仅与一个数据库联系；

②、一旦建立，数据文件只增不减；

③、一个表空间（数据库存储的逻辑单位）由一个或多个数据文件组成。

其次，我们再来叙述一下Oracle的逻辑结构：Oracle的逻辑结构包括表空间（tablespace），段（segment），数据块（data block）以及模式对象（schema object）。

Oracle数据库在逻辑上是由多个表空间组成的，表空间在物理上包含一个或多个数据文件。而数据文件大小是块大小的整数倍；表空间中存储的对象叫段，比如数据段，索引段和回退段。段由区组成，区是磁盘分配的最小单位。段的增大是通过增加区的个数来实现的。每个区的大小是数据块大小的整数倍，区的大小可以不相同；数据块是数据库中的最小的I/O单位，同时也是内存数据缓冲区的单位，及数据文件存储空间单位。块的大小由参数DB_BLOCK_SIZE设置，其值应设置为操作系统块大小的整数倍。

⑴、表空间（tablespace）
表空间是数据库中最大的逻辑单位，每一个表空间由一个或多个数据文件组成，一个数据文件只能与一个表空间相联系。每一个数据库都有一个SYSTEM表空间，该表空间是在数据库创建或数据库安装时自动创建的，用于存储系统的数据字典表，程序系统单元，过程函数，包和触发器等，也可用于存储用户数据表，索引对象。表空间具有在线（online）和离线（offline）属性，可以将除SYSTME以外的其他任何表空间置为离线。

⑵、段（segment）
数据库的段可以分为四类：数据段、索引段、回退段和临时段。

⑶、区
区是磁盘空间分配的最小单位。磁盘按区划分，每次至少分配一个区。区存储与段中，它由连续的数据块组成。

⑷、数据块
数据块是数据库中最小的数据组织单位与管理单位，是数据文件磁盘存储空间单位，也是数据库I/O的最小单位，数据块大小由DB_BLOCK_SIZE参数决定，不同的Oracle版本DB_BLOCK_SIZE的默认值是不同的。

⑸、模式对象
模式对象是一种应用，包括：表、聚簇、视图、索引序列生成器、同义词、哈希、程序单元、数据库链等。

最后，在来说一下Oracle的用户、表空间和数据文件的关系：
一个用户可以使用一个或多个表空间，一个表空间也可以供多个用户使用。用户和表空间没有隶属关系，表空间是一个用来管理数据存储的逻辑概念，表空间只是和数据文件发生关系，数据文件是物理的，一个表空间可以包含多个数据文件，而一个数据文件只能隶属一个表空间。

总结一下：解释数据库、表空间、数据文件、表、数据的最好办法就是想象一个装满东西的柜子。数据库其实就是柜子，柜中的抽屉是表空间，抽屉中的文件夹是数据文件，文件夹中的纸是表，写在纸上的信息就是数据。

## 用户，表空间，表之间的关系

用户=商家

表=商品

表空间=仓库

1. 1个商家能有很多商品，1个商品只能属于一个商家

2. 1个商品可以放到仓库A，也可以放到仓库B，但不能同时放入A和B

3. 仓库不属于任何商家

4. 商家都有一个默认的仓库，如果不指定具体仓库，商品则放到默认的仓库中

## 删除表空间的时候报错

> ORA-29857: 表空间中存在域索引和/或次级对象

可能是因为是某个用户默认表空间的原因。所以需要先删除用户，然后再执行表空间的删除操作。
在sqlplus执行查询语句`select username,default_tablespace from dba_users`发现确实有用户的默认表空间是我要删除的表空间，然后`drop user  用户名 cascade` ;然后重新执行表空间的删除操作`drop tablespace 表空间名 including contents and datafiles cascade constraints`
